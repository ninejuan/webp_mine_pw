<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>스네이크 지뢰찾기</title>
    <style>
      /* 전체 페이지 스타일 */
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #f0f0f0;
      }
      /* 게임 컨테이너 스타일 */
      #game-container {
        text-align: center;
      }
      /* 게임 보드 스타일 */
      #game-board {
        display: inline-grid;
        grid-template-columns: repeat(10, 30px);
        grid-template-rows: repeat(10, 30px);
        gap: 1px;
        background-color: #ccc;
        border: 1px solid #999;
      }
      /* 각 셀 스타일 */
      .cell {
        width: 30px;
        height: 30px;
        background-color: #fff;
        border: 1px solid #ccc;
      }
      /* 뱀 스타일 */
      .snake {
        background-color: #4caf50;
      }
      /* 지뢰 스타일 */
      .mine {
        background-color: #f44336;
      }
      /* 확인된 셀 스타일 */
      .checked {
        background-color: #2196f3;
      }
    </style>
  </head>
  <body>
    <div id="game-container">
      <h1>스네이크 지뢰찾기</h1>
      <p>
        지뢰를 피해 20개의 안전 구역을 찾아보세요!
      </p>
      <div id="game-board"></div>
      <p>
        방향키를 사용하여 뱀을 움직이세요. Space키를 눌러 지뢰를 찾아보세요.
      </p>
      <p>
        Score: <span id="score">0</span> | 뱀의 길이:
        <span id="length">1</span> | 지뢰의 갯수 :
        <span id="mine_count">20</span>
      </p>
      <button onclick="startGame()">New Game</button>
    </div>

    <script>
      // 게임에 필요한 전역 변수들을 선언합니다.
      const board = document.getElementById("game-board");
      const scoreElement = document.getElementById("score");
      const lengthElement = document.getElementById("length");
      let snake = [{ x: 0, y: 0 }]; // 뱀의 초기 위치
      let direction = "right"; // 뱀의 초기 이동 방향
      let mines = []; // 지뢰의 위치를 저장할 배열
      let score = 0; // 현재 점수
      let gameInterval; // 게임 루프를 위한 인터벌 ID
      let growthPending = 0; // 뱀이 성장해야 할 길이

      // 게임 보드를 생성하는 함수
      function createBoard() {
        board.innerHTML = "";
        for (let i = 0; i < 100; i++) {
          const cell = document.createElement("div");
          cell.classList.add("cell");
          board.appendChild(cell);
        }
      }

      // 지뢰를 무작위로 배치하는 함수
      function placeMines() {
        mines = [];
        for (let i = 0; i < 20; i++) {
          let x, y;
          do {
            x = Math.floor(Math.random() * 10);
            y = Math.floor(Math.random() * 10);
          } while (mines.some((mine) => mine.x === x && mine.y === y));
          mines.push({ x, y });
        }
      }

      // 뱀을 화면에 그리는 함수
      function drawSnake() {
        // 기존의 뱀 표시를 모두 제거
        document
          .querySelectorAll(".snake")
          .forEach((cell) => cell.classList.remove("snake"));
        // 새로운 뱀의 위치를 표시
        snake.forEach((segment) => {
          const cell = board.children[segment.y * 10 + segment.x];
          cell.classList.add("snake");
        });
      }

      // 뱀을 움직이는 함수
      function moveSnake() {
        const head = { ...snake[0] }; // 현재 머리 위치를 복사
        // 이동 방향에 따라 머리 위치 업데이트
        switch (direction) {
          case "up":
            head.y--;
            break;
          case "down":
            head.y++;
            break;
          case "left":
            head.x--;
            break;
          case "right":
            head.x++;
            break;
        }

        // 벽이나 자기 자신과 충돌했는지 확인
        // some 함수 : Array 안의 어떠한 요소라도 판별함수를 통과한다면 true 반환
        if (
          head.x < 0 ||
          head.x > 9 ||
          head.y < 0 ||
          head.y > 9 ||
          snake.some((segment) => segment.x === head.x && segment.y === head.y)
        ) {
          gameOver();
          return;
        }

        // 뱀의 머리를 새 위치로 이동
        snake.unshift(head);
        if (growthPending > 0) {
          growthPending--; // 성장해야 할 길이가 남아있으면 꼬리를 제거하지 않음
        } else {
          snake.pop(); // 성장할 필요가 없으면 꼬리 제거
        }
        drawSnake();
        updateLength();
      }

      // 현재 위치의 셀을 확인하는 함수
      function checkCell() {
        const head = snake[0];
        const cell = board.children[head.y * 10 + head.x];
        if (!cell.classList.contains("checked")) {
          if (mines.some((mine) => mine.x === head.x && mine.y === head.y)) {
            // 지뢰를 밟았을 경우
            cell.classList.add("mine");
            gameOver();
          } else {
            // 안전한 셀일 경우
            cell.classList.add("checked");
            score++;
            scoreElement.textContent = score;
            growthPending++;
            updateLength();
            if (snake.length >= 20) {
              winGame();
            }
          }
        }
      }

      // 뱀의 길이를 업데이트하는 함수
      function updateLength() {
        lengthElement.textContent = snake.length + growthPending;
      }

      // 게임 오버 처리 함수
      function gameOver() {
        clearInterval(gameInterval);
        alert(`${score}점을 넘기지 못하고 패배하였습니다.`);
      }

      // 승리 처리 함수
      function winGame() {
        clearInterval(gameInterval);
        alert(`축하합니다. ${score}점을 획득하여 승리하였습니다!`);
      }

      // 게임을 시작하는 함수
      function startGame() {
        createBoard();
        placeMines();
        snake = [{ x: 0, y: 0 }];
        direction = "right";
        score = 0;
        growthPending = 0;
        scoreElement.textContent = score;
        updateLength();
        clearInterval(gameInterval);
        gameInterval = setInterval(moveSnake, 200); // 200ms마다 뱀을 움직임
      }

      // 키보드 입력을 처리하는 이벤트 리스너
      document.addEventListener("keydown", (e) => {
        e.preventDefault(); // 기본 키 동작을 막음
        switch (e.key) {
          case "ArrowUp":
            if (direction !== "down") direction = "up";
            break;
          case "ArrowDown":
            if (direction !== "up") direction = "down";
            break;
          case "ArrowLeft":
            if (direction !== "right") direction = "left";
            break;
          case "ArrowRight":
            if (direction !== "left") direction = "right";
            break;
          case " ":
            checkCell();
            break; // 스페이스바로 현재 셀 확인
        }
      });
    </script>
  </body>
</html>
